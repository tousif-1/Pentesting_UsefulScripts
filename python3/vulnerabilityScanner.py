import os
import socket
import sys

def bannerFetch(ip,port):
    try:
        socket.setdefaulttimeout(3)
        s = socket.socket()
        s.connect((ip,port))
        banner = s.recv(1024)  
        return banner.decode('UTF-8') #Byte type to String
    except:
        return

def checkVuln(banner,filename):
    f = open(filename,'r')
    for line in f.readlines():
        if line.rstrip() in banner:
            print('[+] Server is Vulnerbable: Vulnerable banner --> ' +banner)

def main():
	if len(sys.argv) == 2:
		filename = sys.argv[1]
		if not os.path.isfile(filename):
			print('[-] File '+ filename +' Does not exist')
			exit(0)
		if not os.access(filename, os.R_OK): #Check read permission
			print('[-] Can not read file: ' + filename)
			exit(0)
	else:
		print('[-] Usage: ' +sys.argv[0]+ ' <vulnerableBanners.txt>')
		exit(0)
	portList = [21,22,23,80,111,139,443,514, 6667]
	for x in range(147,148):
		ip = "192.168.88." + str(x)
		print ('[+] Scanning ' +ip+ ' . . .')
		for port in portList:
			
			banner = bannerFetch(ip,port)
			
			if banner:
				print('[+] Banner for ' +ip+ ':' +str(port)+ ' is ' +banner)
				checkVuln(banner, filename)


main()
